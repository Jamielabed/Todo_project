<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Main</title>
    <link rel="stylesheet" href="/css/main.css">
  </head>
  <body>
    <script type="text/javascript">
    const GOOGLE_API_KEY = "{{api_key}}"
    </script>
    {% if lat and long  %}
    <div id="restaurants_info">
      {% if user %}
       <h2>User is {{user.email()}}<span id="favorites"> My Favorites</span></h2>
       <br>
       <form action="/?lat={{lat}}&long={{long}}&filter_selection={{filter_selection}}">
         <select name="sort_selection">
           {%if sort_selection == "distance"%}
           <option value="sort-by">Sort By</option>
           <option selected value="distance">Distance</option>
           <option value="rating">Rating</option>
           {%elif sort_selection == "rating"%}
           <option value="sort-by">Sort By</option>
           <option value="distance">Distance</option>
           <option selected value="rating">Rating</option>
           {%else%}
           <option value="sort-by">Sort By</option>
           <option value="distance">Distance</option>
           <option value="rating">Rating</option>
           {%endif%}
          </select>

          <input type="submit" name="" value="Submit">

          <input type="text" hidden name="filter_selection" value="{{filter_selection}}">
          <input type="text" hidden name="lat" value="{{lat}}">
          <input type="text" hidden name="long" value="{{long}}">
        </form>

        <form action="/?lat={{lat}}&long={{long}}&sort_selection={{sort_selection}}">
          <select name="filter_selection" value = "Filter">
            <option value="all-types">All Food Types</option>
            {%for food_type in food_types%}
            {%if filter_selection == food_type%}
            <option selected value="{{food_type}}">{{food_type}}</option>
            {%else%}
            <option value="{{food_type}}">{{food_type}}</option>
            {%endif%}
            {%endfor%}
           </select>

           <input type="submit" name="" value="Submit">
           <input type="text" hidden name="lat" value="{{lat}}">
           <input type="text" hidden name="long" value="{{long}}">
           <input type="text" hidden name="sort_selection" value="{{sort_selection}}">
         </form>
        <br>
       <!--if food preferences != NONE -->



       <div class="flex-container">
         <table id="restaurants-table">
           {%for restaurant in restaurants%}
           {% if restaurants.index(restaurant) % 6 == 0%}
            <tr>
           {%endif%}
           <td>
           <a href = "{{restaurant['url']}}"target="_blank">
             <div class="restaurant">
               <p class = "restaurant-head">{{restaurant['name']}}</p>
               <div class = "rest-info-div">
                 <p class = "rest-info">Yelp Rating: {{restaurant["rating"]}}
                   <br>Drive Time: {{restaurant["duration"]}}
                   <br>Type of Food: {{restaurant["categories"][0]["title"]}}

                 </p>
               </div>
             </div>
             </a>
            <form action="/AddFavorite?restaurantname={{restaurant['name']}}" method="post">
              <input type="submit" class = "add_restaurant" value="Add to Favorites"></input>
            </form>

           </td>
           {% if restaurants.index(restaurant) % 6 == 5%}
            </tr>
           {%endif%}
        <!-- <button type="button">Click Me!</button> -->
           {%endfor%}
          </table>
        </div>

      <br>
       <a href="{{logout_url}}">Logout</a>
       {% else %}
      <h1>No user!</h1>
       <a href="{{login_url}}">Login</a>
      {% endif %}
    </div>
    <script type="text/javascript" src="/js/main.js"></script>

    {%else%}
    <script type="text/javascript" src="/js/getlocation.js"></script>

    {%endif%}
  </body>
</html>
